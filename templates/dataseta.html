<!DOCTYPE html>
<html>
<head>
  <title>Covid-19 Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</head>
<body>

<h1  id="header">CS127: Covid-19 Dashboard</h1>

<h3>Dataset A </h3>

<div id="graph_A">
  <canvas id="line-chart" width="200" height="80"></canvas><br>
  <canvas id="death-chart" width="300" height="100"></canvas><br>
  <canvas id="recover-chart" width="300" height="100"></canvas><br>
  <canvas id="confirm-chart" width="300" height="100"></canvas><br>
</div>




<!-- JAVASCRIPT -->
<script type="text/javascript">

createChart();

async function createChart(){
  const data = await getISS();
  const countries = ["China", "Philippines", "Russia", "Afghanistan", "Spain"];

  //Line chart
  new Chart(document.getElementById("line-chart"), {
    type: 'line',
    data: 
    {
      labels: data.date,
      datasets: [{ 
          data: data.confirmed_ph,
          label: "confirmed cases",
          borderColor: "#c45850",
          fill: false
        }, { 
          data: data.recovered_ph,
          label: "recoveries",
          borderColor: "#3e95cd",
          fill: false
        }, { 
          data: data.died_ph,
          label: "deaths",
          borderColor: "black",
          fill: false
        }]
    },
    options: {
      title: {
        display: true,
        text: 'Number of deaths, recoveries, and confirmed cases in the Philippines'
      }
    }
  });



// Bar charts
new Chart(document.getElementById("death-chart"), {
    type: 'bar',
    data: {
      labels: countries,
      datasets: [
        {
          label: "Total cases",
          backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850"],
          data: data.countries_dth,
        }
      ]
    },
    options: {
      legend: { display: false },
      title: {
        display: true,
        text: 'TOTAL NUMBER OF DEATHS IN 5 COUNTRIES'
      }
    }
});

new Chart(document.getElementById("recover-chart"), {
    type: 'bar',
    data: {
      labels: countries,
      datasets: [
        {
          label: "Total cases",
          backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850"],
          data: data.countries_rec,
        }
      ]
    },
    options: {
      legend: { display: false },
      title: {
        display: true,
        text: 'TOTAL NUMBER OF RECOVERIES IN 5 COUNTRIES'
      }
    }
});

new Chart(document.getElementById("confirm-chart"), {
    type: 'bar',
    data: {
      labels: countries,
      datasets: [
        {
          label: "Total cases",
          backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850"],
          data: data.countries_con,
        }
      ]
    },
    options: {
      legend: { display: false },
      title: {
        display: true,
        text: 'TOTAL NUMBER OF CONFIRMED CASES IN 5 COUNTRIES'
      }
    }
});



}


async function getISS(){
  const api_url = 'https://pomber.github.io/covid19/timeseries.json';
  const countries_con = [];
  const countries_rec = [];
  const countries_dth= [];

  const date = [];
  const confirmed_ph = [];
  const recovered_ph = [];
  const died_ph = [];


  const response = await fetch (api_url);
  const data = await response.json();
  const { China, Philippines, Russia, Afghanistan, Spain } = data;


  for(i=0; i<Philippines.length; i++){
    if (Philippines[i].confirmed > 99){
      date.push(data.Philippines[i].date);
      confirmed_ph.push(data.Philippines[i].confirmed);
      recovered_ph.push(data.Philippines[i].recovered);
      died_ph.push(data.Philippines[i].deaths);
    }
  }

  const total = China.length-1;
  countries_con.push(China[total].confirmed);
  countries_con.push(Philippines[total].confirmed);
  countries_con.push(Russia[total].confirmed);
  countries_con.push(Afghanistan[total].confirmed);
  countries_con.push(Spain[total].confirmed);
  
  countries_rec.push(China[total].recovered);
  countries_rec.push(Philippines[total].recovered);
  countries_rec.push(Russia[total].recovered);
  countries_rec.push(Afghanistan[total].recovered);
  countries_rec.push(Spain[total].recovered);

  countries_dth.push(China[total].deaths);
  countries_dth.push(Philippines[total].deaths);
  countries_dth.push(Russia[total].deaths);
  countries_dth.push(Afghanistan[total].deaths);
  countries_dth.push(Spain[total].deaths);


  return { date, confirmed_ph, recovered_ph, died_ph, countries_con, countries_rec, countries_dth };




}




</script>
</body>
</html>